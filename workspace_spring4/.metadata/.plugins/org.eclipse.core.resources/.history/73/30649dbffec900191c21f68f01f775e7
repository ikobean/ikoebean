<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@ page import = "java.util.List, java.util.Map, java.util.HashMap" %>
<%
	List<Map<String, Object>> boardDetail
		=(List<Map<String, Object>>)request.getAttribute("boardDetail");
   	Map<String,Object> rMap = new HashMap<>();
   	  /* 
   	    *마이바티스 사용시 자동으로 담아주므로 VO의 경우
   	    *사용자가 대소문자를 구분해서 사용하지만
   	    *Map의 경우 마이바티스가 컬럼명을 기준으로 자동으로 키값을 생성하는데 
   	    *디폴트가 대문자임.
   	    */
   	if(boardDetail!=null){
   		rMap= boardDetail.get(0);
   	}
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>글 상세보기</title>
<%@ include file="/common/JEasyUICommon.jsp" %>
<script>
	var imsi2;
	function addAction(){
		$('#f_boardAdd').attr("method","post");
		$('#f_boardAdd').attr("action","/board/test.nb?crud=boardAdd");
		$('#f_boardAdd').submit();
		//부모창에 함수를 호출할 때 opener.함수명();
		opener.boardList();
		self.close();
	}
	//있던 파일 삭제
	function fileDel(){
		//원래 있던 파일 이름 받아오기
		imsi2 = $("#filebox").filebox('getText');
		
		//원래 있던 파일 "" 이렇게 만들고 받아오기.
		$("#filebox").filebox('setText',' ');
	}
	//삭제
	function deleteForm(){
		$("#dlg_boardDel").dialog({
		 	 buttons: btn_boardDel 
			,title:'글삭제'
			,width: '420px'
			,height: '250px'
			,modal: true
			,href:'boardDelForm.jsp?'
		});
		$('#dlg_boardDel').dialog('open');	

	}
    function boardDel(){
    	//alert("삭제확인 버튼 눌렀니?");
    	var db_pw = <%=rMap.get("BM_PW")%>;
    	//현재 내가 위치하는 페이지와 비번 입력받는 화면이 다르다. 접근이 가능한가?
    	var u_pw = $("#u_pw").passwordbox('getValue');
    	//alert(db_pw + ", "+u_pw);
    	/*
    	사용자가 입력한 비번과 DB에서 읽어들인 비번을 비교하여 일치하면 삭제 처리 진행
    	불일치시 비번을 다시 입력받도록 한다.
    	*/
    	if(db_pw == u_pw){ //비번이 일치했을 때 삭제 프로세스를 태운다.
    		alert("같다");
    		$.messager.confirm('Confirm','R U SURE?',function(r){
    			if(r){
    				location.href="/sample/board/boardDel.mvc"
    			}
    		});
    	}else{
    		alert("다르다"); 
    		$("#bm_pw").passwordbox('setValue','');
    	}
    } 
	function boardDelClose(){
		$('#dlg_boardDel').dialog('close');	
	}
	//댓글쓰기
	function replyForm(){
		$("#dlg_boardAdd").dialog('open');
	}
	//수정
    function boardUpd(){
    	var db_pw = <%=rMap.get("BM_PW")%>;
    	//현재 내가 위치하는 페이지와 비번 입력받는 화면이 다르다. 접근이 가능한가?
    	var u_pw = $("#u_pw").passwordbox('getValue');
    	//alert(db_pw + ", "+u_pw);
    	/*
    	사용자가 입력한 비번과 DB에서 읽어들인 비번을 비교하여 일치하면 삭제 처리 진행
    	불일치시 비번을 다시 입력받도록 한다.
    	*/
    	if(db_pw == u_pw){ //비번이 일치했을 때 삭제 프로세스를 태운다.
    		$("#dlg_boardUpd").dialog('close');
    		updateForm();
    		
    	}else{
    		alert("비밀번호 틀렸어!"); 
    		$("#u_pw").passwordbox('setText','');
    	}
    } 
	
	function updatecheck(){
		$("#dlg_boardUpd").dialog({
		 	 buttons: btn_boardUpd
			,title:'글수정'
			,width: '420px'
			,height: '250px'
			,modal: true
			,href:'boardUpdForm.jsp?'
		});
		$('#dlg_boardUpd').dialog('open');	
	}
	
	function updateForm(){
		
		$("#bm_title").textbox('readonly',false);
		$("#bm_writer").textbox('readonly',false);
		$("#bm_email").textbox('readonly',false);
		$("#bm_content").textbox('readonly',false);
		$('#upd').hide();
		$('#tb_file').hide();
		$('#updsave').show();
		$('#bs_file_edit').show();
		
	}
	
	function boardUpdClose(){
		$("#dlg_boardUpd").dialog('close');
	}
	function saveForm(){
		$("#bs_filee").textbox('setValue',imsi2);
		$("#filebox").filebox('setValue',imsi2);
		$('#f_boardRead').attr("method","post");
		$('#f_boardRead').attr("action","/board/test.nb?crud=boardUpd");
		$('#f_boardRead').submit();
		$('#pan_read').panel('close');
	
	}

	//목록
	function boardList(){
		location.href="/board/test.nb?crud=boardList";
	}
	


</script>
</head>
<body>
	<script>
	$(document).ready(function (){
		$('#updsave').hide();
		$('#bs_file_edit').hide();
		
	});
	</script>
<!-- ===============[[상세조회화면 시작]]==================-->
	<form id="f_boardRead" method="post" enctype="multipart/form-data">
		<input type="hidden" name="crud" value="boardUpd">
		<input type="hidden" name="bm_no" value="<%=rMap.get("BM_NO") %>">
		<table id="pan_read" class="easyui-panel" title="글상세보기" data-options=" modal:'true', footer:'#tb_read'"
			   style="width:550px;height:380px;padding:10px; background:ivory;">
		    <tr>
		    	<td width="100px">제목</td>  
		    	<td width="500px"> 
		    	<input class="easyui-textbox" value="<%=rMap.get("BM_TITLE") %>" data-options="width:'250px', readonly:'true'" id="bm_title" name="bm_title"></td>
		    </tr>
		       <tr>
		    	<td width="100px">작성자</td>
		    	<td width="500px">
		    	<input class="easyui-textbox" value="<%=rMap.get("BM_WRITER") %>" data-options="width:'250px', readonly:'true'" id="bm_writer" name="bm_writer"></td>
		    </tr>
		       <tr>
		    	<td width="100px">이메일</td>
		    	<td width="500px">
		    	<input class="easyui-textbox" value="<%=rMap.get("BM_EMAIL") %>" data-options="width:'250px', readonly:'true'" id="bm_email" name="bm_email"></td>
		    </tr>
		       <tr>
		    	<td width="100px">내용</td>
		    	<td width="500px">
		    	<input class="easyui-textbox" value="<%=rMap.get("BM_CONTENT") %>" data-options="width:'250px',height:'200px',multiline:'true', readonly:'true'" id="bm_content" name="bm_content"></td>
		    </tr>
		       <tr>
		    	<td width="100px">비번</td>
		    	<td width="500px">
		    	<input class="easyui-passwordbox" value="<%=rMap.get("BM_PW") %>" data-options="width:'250px'" id="bm_pw" name="bm_pw" required></td>
		    </tr>
		    <tr>
		    	<td width="100px">첨부파일</td>
		    	<td width="500px">
		    	<span id="tb_file">
		    	<input class="easyui-textbox" value="<%=rMap.get("BS_FILE")%>" data-options="width:'250px'" id="bs_filee" name="bs_filee">
		    	</span>
		    	<span id="bs_file_edit">
		    	<input class="easyui-filebox"  value="<%=rMap.get("BS_FILE")%>" data-options="width:'250px'" id="filebox" name="bs_file">
	   			<a href="javascript:fileDel()" class="easyui-linkbutton" iconCls="icon-cancel">파일삭제</a></td>
	   			</span>
	   		</tr>
		</table>
</form>
<!-- =======================================[[상세조회화면 끝]]===============================-->
		<!-- 입력 화면 버튼 추가 -->
		<div id="tb_read" align="center">
			<a href="javascript:replyForm()" class="easyui-linkbutton" iconCls="icon-edit"> 댓글</a>
			<span id="upd">
			<a href="javascript:updatecheck()"  class="easyui-linkbutton" iconCls="icon-add" > 수정</a>
			</span>
			<span id="updsave">
			<a href="javascript:saveForm()" class="easyui-linkbutton" iconCls="icon-add"> 수정저장</a>
		<!-- 	<input href="javascript:saveForm()"  class="easyui-linkbutton" iconCls="icon-add"> -->
			</span>
			<a href="javascript:deleteForm()" class="easyui-linkbutton" iconCls="icon-remove"> 삭제</a>
			<a href="javascript:boardList()" class="easyui-linkbutton" iconCls="icon-search" >목록</a>
		</div>   


<!-- ===============[[상세조회화면 끝]]==================-->


<!-- 수정하기, 삭제하기, 댓글쓰기, 목록 버튼 -->
<!-- ===================[[글 수정하기]]====================== -->
<div id="dlg_boardUpd" class="easyui-dialog" data-options="closed:true" style="padding:20px 50px ">
	<div id="btn_boardUpd" align="right">
		<a href="javascript:boardUpd()" class="easyui-linkbutton" iconCls="icon-ok">확인</a>
		<a href="javascript:boardUpdClose()" class="easyui-linkbutton" iconCls="icon-cancel">닫기</a>
	</div>
</div>
<!-- ===================[[글 수정하기]]====================== -->

<!-- ===================[[글 삭제하기]]====================== -->
<div id="dlg_boardDel" class="easyui-dialog" data-options="closed:true" style="padding:20px 50px ">

	<!-- 확인 버튼과 닫기 버튼 추가 -->
	<div id="btn_boardDel" align="right">
		<a href="javascript:boardDel()" class="easyui-linkbutton" iconCls="icon-ok">확인</a>
		<a href="javascript:boardDelClose()" class="easyui-linkbutton" iconCls="icon-cancel">닫기</a>
	</div>
</div>
<!-- ===================[[글 삭제하기]]====================== -->




<!-- ====================[[댓글 쓰기]]====================== -->
<div id="dlg_boardAdd" title="댓글쓰기" class="easyui-dialog" data-options="closed:'true', modal:'true', footer:'#tb_boardAdd'" style="width:600px;height:550px;padding:10px;" >
	<!-- 
		form 전송시 enctype 옵션이 추가되면 request객체로 사용자가 입력한 값을 꺼낼 수 없다. 
		MultipartRequest => cos.jar
	-->

		<form id="f_boardAdd" method="post" enctype="multipart/form-data">
	<!--  	<input type="hidden" name="crud" value="boardAdd"> -->
		<input type="hidden" name="bm_no" value="<%=rMap.get("BM_NO") %>">
		<input type="hidden" name="bm_group" value="<%=rMap.get("BM_GROUP")%>">
		<input type="hidden" name="bm_pos" value="<%=rMap.get("BM_POS")%>">
		<input type="hidden" name="bm_step" value="<%=rMap.get("BM_STEP")%>">
	
	    <table>
	    <tr>
	    	<td width="100px">제목</td>  
	    	<td width="500px">
	    	<input class="easyui-textbox" data-options="width:'250px'" id="bm_title" name="bm_title"></td>
	    </tr>
	       <tr>
	    	<td width="100px">작성자</td>
	    	<td width="500px">
	    	<input class="easyui-textbox" data-options="width:'250px'" id="bm_writer" name="bm_writer"></td>
	    </tr>
	       <tr>
	    	<td width="100px">이메일</td>
	    	<td width="500px">
	    	<input class="easyui-textbox" data-options="width:'250px'" id="bm_email" name="bm_email"></td>
	    </tr>
	       <tr>
	    	<td width="100px">내용</td>
	    	<td width="500px">
	    	<input class="easyui-textbox" data-options="width:'250px',height:'200px'" id="bm_content" name="bm_content"></td>
	    </tr>
	       <tr>
	    	<td width="100px">비번</td>
	    	<td width="500px">
	    	<input class="easyui-passwordbox" data-options="width:'250px'" id="bm_pw" name="bm_pw" required></td>
	    </tr>
	</table>
	</form>
</div>

<!-- 입력 화면 버튼 추가 -->
<div id="tb_boardAdd" align="right">
	<a href="javascript:addAction()" class="easyui-linkbutton" iconCls="icon-save"> 저장</a>
	<a href="javascript:$('#dlg_boardAdd').dialog('close')" iconCls="icon-clear" class="easyui-linkbutton"> 닫기</a>
</div>

<!-- ====================[[댓글 쓰기]]====================== -->
</body>
</html>